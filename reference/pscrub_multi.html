<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compare projection scrubbing measures with pscrub_multi — pscrub_multi • fMRIscrub</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compare projection scrubbing measures with pscrub_multi — pscrub_multi"><meta property="og:description" content="Calculates leverage to identify outliers in high-dimensional data.
Can get results using multiple kinds of projections."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fMRIscrub</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.13.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/projection_scrubbing.html">Projection scrubbing for outlier detection in high-dimensional data with `fMRIscrub`</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mandymejia/fMRIscrub/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compare projection scrubbing measures with <code>pscrub_multi</code></h1>
    <small class="dont-index">Source: <a href="https://github.com/mandymejia/fMRIscrub/blob/0.13.0.s/R/pscrub_multi.R" class="external-link"><code>R/pscrub_multi.R</code></a></small>
    <div class="hidden name"><code>pscrub_multi.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculates leverage to identify outliers in high-dimensional data.
Can get results using multiple kinds of projections.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pscrub_multi</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  projection <span class="op">=</span> <span class="st">"ICA_kurt"</span>,</span>
<span>  nuisance <span class="op">=</span> <span class="st">"DCT4"</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comps_mean_dt <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  comps_var_dt <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  kurt_quantile <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  get_dirs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  full_PCA <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  get_outliers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Wide numeric data matrix (\(T\) observations by \(V\) variables,
\(T &lt;&lt; V\)). If <code>X</code> represents an fMRI run, \(T\) should be the
number of timepoints and \(V\) should be the number of vertices/voxels.
Projection scrubbing will measure the outlyingness of each row in <code>X</code>.</p></dd>


<dt id="arg-projection">projection<a class="anchor" aria-label="anchor" href="#arg-projection"></a></dt>
<dd><p>Projection scrubbing projects the data onto directions
likely to contain outlier information. Choose at least one of the following:</p>
<dl><dt><code>"PCA"</code></dt>
<dd><p>PCA using the top \(k\) PCs.</p></dd>

<dt><code>"PCA_kurt"</code></dt>
<dd><p>PCA using the high-kurtosis PCs among the top \(k\).</p></dd>

<dt><code>"PCA2"</code></dt>
<dd><p>PCA using the top \(k2\) PCs.</p></dd>

<dt><code>"PCA2_kurt"</code></dt>
<dd><p>PCA using the high-kurtosis PCs among the top \(k2\).</p></dd>

<dt><code>"ICA"</code></dt>
<dd><p>ICA using the top \(k\) ICs.</p></dd>

<dt><code>"ICA_kurt"</code></dt>
<dd><p>ICA using the high-kurtosis ICs among the top \(k\).</p></dd>

<dt><code>"ICA2"</code></dt>
<dd><p>ICA using the top \(k2\) ICs.</p></dd>

<dt><code>"ICA2_kurt"</code></dt>
<dd><p>ICA using the high-kurtosis ICs among the top \(k2\).</p></dd>


</dl><p>where \(k\) is the number of components determined by PESEL, and \(k2\)
is the number of principal components with above-average variance.</p>
<p>Use <code>"all"</code> to use all projection methods. Default: <code>"ICA_kurt"</code>.</p></dd>


<dt id="arg-nuisance">nuisance<a class="anchor" aria-label="anchor" href="#arg-nuisance"></a></dt>
<dd><p>Nuisance signals to regress from each column of <code>X</code>.
Should be specified as a design matrix: a \(T\) by \(N\) numeric matrix
where \(N\) represents the number of nuisance signals. Or can be "DCT4"
(default), which will create a matrix with a constant column (the intercept
term) and four DCT bases. This default nuisance regression will have the
effect of demeaning and detrending the data by removing low-frequency
components. To not perform any nuisance regression set this argument to
<code>NULL</code>, <code>0</code>, or <code>FALSE</code>.</p>
<p>Detrending is highly recommended for time-series data, especially if there
are many time points or evolving circumstances affecting the data. Additionally,
if kurtosis is being used to select the projection directions, trends can
induce positive or negative kurtosis, contaminating the connection between
high kurtosis and outlier presence. Detrending should not be used with
non-time-series data because the observations are not temporally related.</p>
<p>Additional nuisance regressors can be specified like so:
<code>cbind(1, fMRItools::dct_bases(nrow(x), 4), more_nuisance)</code>.</p></dd>


<dt id="arg-center-scale">center, scale<a class="anchor" aria-label="anchor" href="#arg-center-scale"></a></dt>
<dd><p>Center the columns of the data by their medians, and scale the
columns of the data by their median absolute deviations (MADs)? Default: <code>TRUE</code>.
Centering is necessary for computing the projections, so if <code>center</code> is
<code>FALSE</code>, the data must already be centered.</p>
<p>Note that centering and scaling occur after nuisance regression, so even if
<code>center</code> is <code>FALSE</code>, the data will be centered on the means if
the nuisance regression included an intercept term, as it does by default.</p></dd>


<dt id="arg-comps-mean-dt-comps-var-dt">comps_mean_dt, comps_var_dt<a class="anchor" aria-label="anchor" href="#arg-comps-mean-dt-comps-var-dt"></a></dt>
<dd><p>Stabilize the mean and variance of each
projection component's timecourse prior to computing kurtosis and leverage?
These arguments should be <code>TRUE</code>, <code>FALSE</code> (default), or the number
of DCT bases to use for detrending (<code>TRUE</code> will use 4).
Note that these arguments affect the projection components and not the data
itself. Also, if variance-stabilizing but not mean-stabilizing,
the components must already be expected to be mean-stabilized, for example
if the data was rigorously detrended; otherwise, the results will be invalid.</p>
<p>Slow-moving mean and variance patterns in the components will interfere with
the roles of kurtosis and leverage in identifying outliers. While
<code>nuisance</code> can be used to detrend the data, this nuisance regression is
estimated <em>non-robustly</em>, since a robust model takes too long to estimate
at each data location. On the other hand, <code>comps_mean_dt</code> and
<code>comps_var_dt</code> can be used to apply a <em>robust</em> nuisance regression at each
component, since there are much fewer components than original data locations.
Thus, even if the data has been detrended with <code>nuisance</code> it may be
helpful to detrend the components with <code>comps_mean_dt</code>; furthermore,
the data nuisance regression does not address the potential existence of variance
patterns in the components.</p>
<p>Overall, for fMRI we recommend enabling <code>comps_mean_dt</code> and <code>comps_var_dt</code>
unless the data has been cleaned not only with a low-pass filter like
DCT nuisance regression, but also with anatomical CompCor, ICA-FIX, or
a similar data-driven strategy that takes into account common sources of
artifactual mean and variance trends such as motion and physiological cycles.</p></dd>


<dt id="arg-kurt-quantile">kurt_quantile<a class="anchor" aria-label="anchor" href="#arg-kurt-quantile"></a></dt>
<dd><p>What quantile cutoff should be used to select the
components? Default: <code>0.99</code>. Use <code>0</code> to select all high-variance
components regardless of kurtosis value.</p>
<p>We model each component as a length \(T\) vector of Normal iid random variables,
for which the distribution of kurtosis values can be approximated. The
quantile is estimated based on this distribution.</p></dd>


<dt id="arg-get-dirs">get_dirs<a class="anchor" aria-label="anchor" href="#arg-get-dirs"></a></dt>
<dd><p>Should the projection directions be returned? This is the
\(V\) matrix in PCA and \(S\) matrix in ICA. The default is <code>FALSE</code>
to save memory. However, <code>get_dirs==TRUE</code> is required for <code><a href="artifact_images.html">artifact_images</a></code>.</p></dd>


<dt id="arg-full-pca">full_PCA<a class="anchor" aria-label="anchor" href="#arg-full-pca"></a></dt>
<dd><p>Only applies to the PCA projection. Return the full SVD?
Default: <code>FALSE</code> (return only the high-variance components).</p></dd>


<dt id="arg-get-outliers">get_outliers<a class="anchor" aria-label="anchor" href="#arg-get-outliers"></a></dt>
<dd><p>Should outliers be flagged based on <code>cutoff</code>? Default: <code>TRUE</code>.</p></dd>


<dt id="arg-cutoff">cutoff<a class="anchor" aria-label="anchor" href="#arg-cutoff"></a></dt>
<dd><p>Median leverage cutoff value. Default: <code>4</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Set a seed right before the call to <code><a href="https://rdrr.io/pkg/pesel/man/pesel.html" class="external-link">pesel::pesel</a></code> or
<code>ica::icaimax</code>? If <code>NULL</code>, do not set a seed. If numeric (default:
<code>0</code>), will use as the seed.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Should occasional updates be printed? Default: <code>FALSE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>"pscrub_multi"</code> object, i.e. a list with components</p><dl><dt>measure</dt>
<dd><p>A \(T\) by \(P\) data.frame of numeric leverage values, each column being the leverage values for a projection method in <code>projection</code>.</p></dd>

<dt>measure_info</dt>
<dd><p>A data.frame with \(P\) rows listing information about each projection used.</p></dd>

<dt>outlier_cutoff</dt>
<dd><p>A \(1\) by \(P\) data.frame of numeric outlier cutoff values for each projection (<code>cutoff</code> times the median leverage).</p></dd>

<dt>outlier_flag</dt>
<dd><p>A \(T\) by \(P\) data.frame of logical values where <code>TRUE</code> indicates where leverage exceeds the cutoff, signaling suspected outlier presence.</p></dd>

<dt>mask</dt>
<dd><p>A length \(P\) numeric vector corresponding to the data locations in <code>X</code>. Each value indicates whether the location was masked:</p><dl><dt>1</dt>
<dd><p>The data location was not masked out.</p></dd>

<dt>-1</dt>
<dd><p>The data location was masked out, because it had at least one <code>NA</code> or <code>NaN</code> value.</p></dd>

<dt>-2</dt>
<dd><p>The data location was masked out, because it was constant.</p></dd>


</dl></dd>

<dt>PCA</dt>
<dd><p>This will be a list with components:</p><dl><dt>U</dt>
<dd><p>The \(T\) by \(Q\) PC score matrix.</p></dd>

<dt>D</dt>
<dd><p>The standard deviation of each PC.</p></dd>

<dt>V</dt>
<dd><p>The \(P\) by \(Q\) PC directions matrix. Included only if <code>get_dirs</code>.</p></dd>

<dt>highkurt</dt>
<dd><p>The length <code>Q</code> logical vector indicating scores of high kurtosis.</p></dd>

<dt>U_dt</dt>
<dd><p>Detrended components of <code>U</code>. Included only if components were mean- or variance-detrended.</p></dd>

<dt>highkurt</dt>
<dd><p>The length <code>Q</code> logical vector indicating detrended scores of high kurtosis.</p></dd>

<dt>nPCs_PESEL</dt>
<dd><p>The number of PCs selected by PESEL.</p></dd>

<dt>nPCs_avgvar</dt>
<dd><p>The number of above-average variance PCs.</p></dd>


</dl><p>where <code>Q</code> is the number of PCs selected by PESEL or of above-average variance (or the greater of the two if both were used).
If PCA was not used, all entries except <code>nPCs_PESEL</code> and/or <code>nPCs_avgvar</code> will not be included, depending on which
method(s) was used to select the number of PCs.</p></dd>

<dt>ICA</dt>
<dd><p>If ICA was used, this will be a list with components:</p><dl><dt>S</dt>
<dd><p>The \(P\) by \(Q\) source signals matrix. Included only if <code>get_dirs</code></p></dd>

<dt>M</dt>
<dd><p>The \(T\) by \(Q\) mixing matrix.</p></dd>

<dt>highkurt</dt>
<dd><p>The length <code>Q</code> logical vector indicating mixing scores of high kurtosis.</p></dd>

<dt>M_dt</dt>
<dd><p>Detrended components of <code>M</code>. Included only if components were mean- or variance-detrended.</p></dd>

<dt>highkurt</dt>
<dd><p>The length <code>Q</code> logical vector indicating detrended mixing scores of high kurtosis. Included only if components were mean- or variance-detrended.</p></dd>


</dl></dd>


</dl></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Amanda Mejia, John Muschelli, Damon Pham.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

